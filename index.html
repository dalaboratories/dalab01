<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Three.js GLB Example mit Fehlerprüfung</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #error {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #f44336;
      color: white;
      padding: 10px;
      font-family: sans-serif;
      display: none;
      z-index: 999;
    }
  </style>
</head>
<body>
  <div id="error"></div>
  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.1/build/three.module.js';
    import { GLTFLoader } from 'https://unpkg.com/three@0.160.1/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.1/examples/jsm/controls/OrbitControls.js';

    function showError(message) {
      const errorBox = document.getElementById('error');
      errorBox.textContent = message;
      errorBox.style.display = 'block';
      console.error(message);
    }

    try {
      // Szene & Kamera
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xeeeeee);

      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 1, 3);

      // Renderer
      let renderer;
      try {
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
      } catch (e) {
        showError('WebGL konnte nicht initialisiert werden. Ist dein Browser kompatibel?');
        throw e;
      }

      // Licht
      scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 0.6));
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(2, 2, 5);
      scene.add(light);

      // Controls
      let controls;
      try {
        controls = new OrbitControls(camera, renderer.domElement);
      } catch (e) {
        showError('OrbitControls konnten nicht geladen werden.');
        throw e;
      }

      // Modell laden
      const loader = new GLTFLoader();
      const modelPath = 'models/model.glb';

      loader.load(
        modelPath,
        function (gltf) {
          try {
            if (!gltf.scene) {
              showError('Modell geladen, aber keine Szene vorhanden.');
              return;
            }
            scene.add(gltf.scene);
          } catch (e) {
            showError('Fehler beim Hinzufügen des Modells zur Szene.');
            throw e;
          }
        },
        function (xhr) {
          // Ladefortschritt
          console.log(`Modell wird geladen: ${(xhr.loaded / xhr.total * 100).toFixed(2)} %`);
        },
        function (error) {
          if (error && error.target && error.target.status === 404) {
            showError(`Modell nicht gefunden: ${modelPath}`);
          } else {
            showError('Fehler beim Laden des GLB-Modells.');
            console.error(error);
          }
        }
      );

      // Render-Schleife
      function animate() {
        requestAnimationFrame(animate);
        try {
          controls.update();
          renderer.render(scene, camera);
        } catch (e) {
          showError('Renderfehler. Überprüfe die Szene und Kamera.');
          throw e;
        }
      }
      animate();

      // Resize-Handling
      window.addEventListener('resize', () => {
        try {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        } catch (e) {
          showError('Fehler beim Anpassen der Fenstergröße.');
          console.error(e);
        }
      });

    } catch (generalError) {
      showError('Ein schwerwiegender Fehler ist aufgetreten. Details siehe Konsole.');
      console.error(generalError);
    }
  </script>
</body>
</html>
